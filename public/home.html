<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BUP Lost & Found | Campus Bulletin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap");

      :root {
        --primary: #4f46e5;
        --primary-light: #6366f1;
        --secondary: #10b981;
        --danger: #ef4444;
        --dark: #1e293b;
        --light: #f8fafc;
        --deep-blue: #1e3a8a; /* Added deep blue color */
      }

      body {
        font-family: "Poppins", sans-serif;
        background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
        min-height: 100vh;
      }

      .nav-glass {
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease; /* Added transition for smooth hide/show */
      }

      .nav-hidden {
        transform: translateY(-100%); /* Hides the nav bar */
      }

      .card-hover {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .card-hover:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }

      .stat-card {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.9) 0%,
          rgba(255, 255, 255, 0.95) 100%
        );
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
      }

      .shine-effect {
        position: relative;
        overflow: hidden;
      }

      .shine-effect::after {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(
          to bottom right,
          rgba(255, 255, 255, 0) 0%,
          rgba(255, 255, 255, 0) 45%,
          rgba(255, 255, 255, 0.3) 48%,
          rgba(255, 255, 255, 0.3) 52%,
          rgba(255, 255, 255, 0) 55%,
          rgba(255, 255, 255, 0) 100%
        );
        transform: rotate(30deg);
        animation: shine 3s infinite linear;
      }

      @keyframes shine {
        0% {
          transform: translateX(-100%) rotate(30deg);
        }
        100% {
          transform: translateX(100%) rotate(30deg);
        }
      }

      .pulse-animation {
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% {
          box-shadow: 0 0 0 0 rgba(79, 70, 229, 0.4);
        }
        70% {
          box-shadow: 0 0 0 10px rgba(79, 70, 229, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(79, 70, 229, 0);
        }
      }

      .text-gradient {
        background: linear-gradient(
          90deg,
          var(--primary) 0%,
          var(--primary-light) 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      /* Update section heading colors */
      h2.text-2xl,
      h2.text-4xl {
        color: var(--deep-blue);
      }
    </style>
  </head>
  <body
    class="bg-[url('home.jpg')] bg-cover bg-center bg-no-repeat min-h-screen"
  >
    <!-- Navigation Bar -->
    <nav id="navbar" class="nav-glass fixed w-full z-50">
      <div
        class="container mx-auto px-4 py-3 flex justify-between items-center"
      >
        <div class="flex items-center space-x-3">
          <div class="shine-effect relative rounded-lg">
            <div
              class="bg-gradient-to-br from-indigo-500 to-indigo-600 p-2 rounded-lg"
            >
              <i class="fas fa-search-location text-white text-xl"></i>
            </div>
          </div>
          <h1
            class="text-2xl font-bold bg-gradient-to-r from-indigo-600 to-indigo-400 bg-clip-text text-transparent"
          >
            BUP <span class="font-light">Lost & Found</span>
          </h1>
        </div>
        <div class="flex items-center space-x-4">
          <button
            id="postItemBtn"
            class="relative overflow-hidden group px-5 py-2.5 rounded-lg bg-gradient-to-br from-indigo-500 to-indigo-600 text-white font-medium shadow-lg hover:shadow-indigo-300 transition-all duration-300"
          >
            <span class="relative z-10 flex items-center">
              <i class="fas fa-plus mr-2"></i> Post Item
            </span>
            <span
              class="absolute inset-0 bg-gradient-to-br from-indigo-600 to-indigo-400 opacity-0 group-hover:opacity-100 transition-opacity duration-300"
            ></span>
          </button>

          <!-- Profile Button -->
          <a
            href="profile.html"
            class="flex items-center space-x-2 px-3 py-2 rounded-lg hover:bg-indigo-50 transition"
          >
            <div class="relative">
              <img
                id="profileImage"
                src="https://via.placeholder.com/40"
                alt="Profile"
                class="w-8 h-8 rounded-full border-2 border-white shadow-md object-cover"
              />
              <div
                class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-green-400 rounded-full border-2 border-white"
              ></div>
            </div>
            <span id="userName" class="font-medium text-slate-700">User</span>
          </a>

          <!-- Logout Button -->
          <button
            id="logoutBtn"
            class="flex items-center px-3 py-2 text-slate-700 hover:text-red-600 transition"
          >
            <i class="fas fa-sign-out-alt mr-2"></i>
            <span class="font-medium">Logout</span>
          </button>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-4 pt-24 pb-12">
      <!-- Hero Section -->
      <section class="mb-12 text-center">
        <h2 class="text-4xl font-bold text-slate-800 mb-3">
          Campus Lost & Found
        </h2>
        <p class="text-lg text-slate-600 max-w-2xl mx-auto">
          Reuniting lost items with their owners across Bangladesh University of
          Professionals
        </p>
      </section>

      <!-- Search and Stats Section -->
      <section class="mb-12">
        <div
          class="bg-white rounded-xl shadow-sm p-6 mb-8 border border-slate-100"
        >
          <div
            class="flex flex-col md:flex-row md:items-center md:justify-between gap-4"
          >
            <div class="relative flex-grow">
              <div
                class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
              >
                <i class="fas fa-search text-slate-400"></i>
              </div>
              <input
                type="text"
                id="searchInput"
                placeholder="Search for lost or found items..."
                class="w-full pl-10 pr-4 py-3 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition"
              />
              <button
                id="searchBtn"
                class="absolute right-3 top-3 text-slate-400 hover:text-indigo-600 transition"
              >
                <i class="fas fa-search"></i>
              </button>
            </div>
            <div class="flex space-x-2">
              <button
                id="filterAll"
                class="filter-btn active px-4 py-2 rounded-lg font-medium bg-indigo-600 text-white shadow-md hover:bg-indigo-700 transition"
              >
                All Items
              </button>
              <button
                id="filterLost"
                class="filter-btn px-4 py-2 rounded-lg font-medium bg-red-100 text-red-600 shadow-md hover:bg-red-200 transition"
              >
                <i class="fas fa-question-circle mr-2"></i> Lost
              </button>
              <button
                id="filterFound"
                class="filter-btn px-4 py-2 rounded-lg font-medium bg-green-100 text-green-600 shadow-md hover:bg-green-200 transition"
              >
                <i class="fas fa-check-circle mr-2"></i> Found
              </button>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5 mb-8">
          <div
            class="stat-card rounded-xl shadow-sm p-6 text-center border border-slate-100"
          >
            <div
              class="w-14 h-14 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-3"
            >
              <i class="fas fa-boxes text-indigo-600 text-xl"></i>
            </div>
            <h3 class="text-slate-500 text-sm font-medium mb-1">Total Items</h3>
            <p id="totalItems" class="text-3xl font-bold text-indigo-600">0</p>
          </div>
          <div
            class="stat-card rounded-xl shadow-sm p-6 text-center border border-slate-100"
          >
            <div
              class="w-14 h-14 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-3"
            >
              <i class="fas fa-question-circle text-red-600 text-xl"></i>
            </div>
            <h3 class="text-slate-500 text-sm font-medium mb-1">Lost Items</h3>
            <p id="lostItems" class="text-3xl font-bold text-red-600">0</p>
          </div>
          <div
            class="stat-card rounded-xl shadow-sm p-6 text-center border border-slate-100"
          >
            <div
              class="w-14 h-14 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3"
            >
              <i class="fas fa-check-circle text-green-600 text-xl"></i>
            </div>
            <h3 class="text-slate-500 text-sm font-medium mb-1">Found Items</h3>
            <p id="foundItems" class="text-3xl font-bold text-green-600">0</p>
          </div>
          <div
            class="stat-card rounded-xl shadow-sm p-6 text-center border border-slate-100"
          >
            <div
              class="w-14 h-14 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3"
            >
              <i class="fas fa-hands-helping text-purple-600 text-xl"></i>
            </div>
            <h3 class="text-slate-500 text-sm font-medium mb-1">Reunited</h3>
            <p id="reunitedItems" class="text-3xl font-bold text-purple-600">
              0
            </p>
          </div>
        </div>
      </section>

      <!-- Items Section -->
      <section class="mb-12">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold text-slate-800 flex items-center">
            <span class="w-1 h-6 bg-indigo-600 rounded-full mr-3"></span>
            Recent Items
          </h2>
          <button
            id="viewAllItemsBtn"
            class="text-indigo-600 hover:text-indigo-800 font-medium flex items-center transition"
          >
            View All <i class="fas fa-arrow-right ml-2 text-sm"></i>
          </button>
        </div>

        <div
          id="itemsContainer"
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
        >
          <!-- Items will be loaded here dynamically -->
          <div class="col-span-full text-center py-12">
            <div class="inline-block p-4 bg-indigo-100 rounded-full mb-3">
              <i class="fas fa-spinner fa-spin text-3xl text-indigo-600"></i>
            </div>
            <p class="text-slate-500">Loading items...</p>
          </div>
        </div>
      </section>

      <!-- Suggestions Section -->
      <section>
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold text-slate-800 flex items-center">
            <span class="w-1 h-6 bg-indigo-600 rounded-full mr-3"></span>
            Community Suggestions
          </h2>
        </div>

        <div
          class="bg-white rounded-xl shadow-sm p-6 mb-6 border border-slate-100"
        >
          <div class="flex items-start space-x-4">
            <img
              id="currentUserImage"
              src="https://via.placeholder.com/40"
              alt="You"
              class="w-10 h-10 rounded-full mt-1 border-2 border-indigo-100 shadow-sm"
            />
            <div class="flex-grow">
              <textarea
                id="suggestionInput"
                rows="3"
                placeholder="Share your suggestions to improve our service..."
                class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition"
              ></textarea>
              <div class="flex justify-end mt-3">
                <button
                  id="postSuggestionBtn"
                  class="px-5 py-2.5 rounded-lg bg-gradient-to-br from-indigo-500 to-indigo-600 text-white font-medium shadow-md hover:shadow-indigo-300 transition-all"
                >
                  Post Suggestion
                </button>
              </div>
            </div>
          </div>
        </div>

        <div id="suggestionsContainer" class="space-y-4">
          <!-- Suggestions will be loaded here dynamically -->
          <div class="text-center py-12">
            <div class="inline-block p-4 bg-indigo-100 rounded-full mb-3">
              <i class="fas fa-spinner fa-spin text-3xl text-indigo-600"></i>
            </div>
            <p class="text-slate-500">Loading suggestions...</p>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="bg-slate-900 text-slate-400 py-12">
      <div class="container mx-auto px-4">
        <div class="flex flex-col md:flex-row justify-between items-center">
          <div class="mb-6 md:mb-0">
            <div class="flex items-center space-x-3 mb-3">
              <div class="bg-indigo-600 p-2 rounded-lg">
                <i class="fas fa-search-location text-white"></i>
              </div>
              <h3 class="text-xl font-bold text-white">BUP Lost & Found</h3>
            </div>
            <p class="max-w-md">
              Bangladesh University of Professionals campus lost and found
              bulletin system.
            </p>
          </div>
          <div class="flex space-x-6">
            <a href="#" class="text-slate-400 hover:text-white transition">
              <i class="fab fa-facebook-f text-lg"></i>
            </a>
            <a href="#" class="text-slate-400 hover:text-white transition">
              <i class="fab fa-twitter text-lg"></i>
            </a>
            <a href="#" class="text-slate-400 hover:text-white transition">
              <i class="fab fa-instagram text-lg"></i>
            </a>
            <a href="#" class="text-slate-400 hover:text-white transition">
              <i class="fab fa-linkedin-in text-lg"></i>
            </a>
          </div>
        </div>
        <div class="border-t border-slate-800 mt-8 pt-8 text-center text-sm">
          <p>© 2025 BUP Lost & Found System. All rights reserved.</p>
        </div>
      </div>
    </footer>

    <!-- Script -->
    <script>
      // Global variables
      let currentUser = null;
      let currentFilter = "all";
      let currentSearchTerm = "";

      // DOM Elements
      const profileImage = document.getElementById("profileImage");
      const currentUserImage = document.getElementById("currentUserImage");
      const userName = document.getElementById("userName");
      const searchInput = document.getElementById("searchInput");
      const searchBtn = document.getElementById("searchBtn");
      const filterAll = document.getElementById("filterAll");
      const filterLost = document.getElementById("filterLost");
      const filterFound = document.getElementById("filterFound");
      const totalItems = document.getElementById("totalItems");
      const lostItems = document.getElementById("lostItems");
      const foundItems = document.getElementById("foundItems");
      const reunitedItems = document.getElementById("reunitedItems");
      const itemsContainer = document.getElementById("itemsContainer");
      const suggestionInput = document.getElementById("suggestionInput");
      const postSuggestionBtn = document.getElementById("postSuggestionBtn");
      const suggestionsContainer = document.getElementById(
        "suggestionsContainer"
      );
      const postItemBtn = document.getElementById("postItemBtn");
      const viewAllItemsBtn = document.getElementById("viewAllItemsBtn");
      const logoutBtn = document.getElementById("logoutBtn");
      const navbar = document.getElementById("navbar"); // Added navbar reference

      // Initialize the page
      document.addEventListener("DOMContentLoaded", async () => {
        // Check authentication
        await checkAuth();

        // Load user data
        await loadUserData();

        // Load stats
        await loadStats();

        // Load items
        await loadItems();

        // Load suggestions
        await loadSuggestions();

        // Set up event listeners
        setupEventListeners();

        // Setup scroll listener for navbar
        setupNavbarScroll();
      });

      // Check authentication
      async function checkAuth() {
        const token = localStorage.getItem("token");
        if (!token) {
          window.location.href = "login.html";
          return;
        }
      }

      // Load user data
      async function loadUserData() {
        try {
          const response = await fetch("/api/users/me", {
            headers: {
              Authorization: `Bearer ${localStorage.getItem("token")}`,
            },
          });

          if (!response.ok) {
            throw new Error("Failed to fetch user data");
          }

          const data = await response.json();
          currentUser = data.user;

          // Update UI with user data
          if (currentUser.profileImage) {
            profileImage.src = currentUser.profileImage;
            currentUserImage.src = currentUser.profileImage;
          } else if (currentUser.idCardImage) {
            profileImage.src = currentUser.idCardImage;
            currentUserImage.src = currentUser.idCardImage;
          }
          userName.textContent = `${currentUser.firstName} ${currentUser.lastName}`;
        } catch (error) {
          console.error("Error loading user data:", error);
          window.location.href = "login.html";
        }
      }

      // Load statistics
      async function loadStats() {
        try {
          const response = await fetch("/api/stats", {
            headers: {
              Authorization: `Bearer ${localStorage.getItem("token")}`,
            },
          });

          if (!response.ok) {
            throw new Error("Failed to fetch stats");
          }

          const data = await response.json();

          // Update stats with animation
          animateValue(
            totalItems,
            0,
            data.stats.lostCount + data.stats.foundCount,
            1000
          );
          animateValue(lostItems, 0, data.stats.lostCount, 1000);
          animateValue(foundItems, 0, data.stats.foundCount, 1000);
          animateValue(reunitedItems, 0, data.stats.claimedCount, 1000);
        } catch (error) {
          console.error("Error loading stats:", error);
          totalItems.textContent = "--";
          lostItems.textContent = "--";
          foundItems.textContent = "--";
          reunitedItems.textContent = "--";
        }
      }

      // Animate counter values
      function animateValue(element, start, end, duration) {
        let startTimestamp = null;
        const step = (timestamp) => {
          if (!startTimestamp) startTimestamp = timestamp;
          const progress = Math.min((timestamp - startTimestamp) / duration, 1);
          element.textContent = Math.floor(progress * (end - start) + start);
          if (progress < 1) {
            window.requestAnimationFrame(step);
          }
        };
        window.requestAnimationFrame(step);
      }

      // Load items
      async function loadItems() {
        try {
          showLoading(itemsContainer, "Loading items...");

          let url = "/api/items";
          if (currentFilter !== "all" || currentSearchTerm) {
            url += "?";
            if (currentFilter !== "all") {
              url += `type=${currentFilter}&`;
            }
            if (currentSearchTerm) {
              url += `search=${encodeURIComponent(currentSearchTerm)}`;
            }
          }

          const response = await fetch(url, {
            headers: {
              Authorization: `Bearer ${localStorage.getItem("token")}`,
            },
          });

          if (!response.ok) {
            throw new Error("Failed to fetch items");
          }

          const data = await response.json();
          renderItems(data.items);
        } catch (error) {
          console.error("Error loading items:", error);
          showError(
            itemsContainer,
            "Failed to load items. Please try again later."
          );
        }
      }

      // Show loading state
      function showLoading(container, message) {
        container.innerHTML = `
                <div class="col-span-full text-center py-12">
                    <div class="inline-block p-4 bg-indigo-100 rounded-full mb-3">
                        <i class="fas fa-spinner fa-spin text-3xl text-indigo-600"></i>
                    </div>
                    <p class="text-slate-500">${message}</p>
                </div>
            `;
      }

      // Show error state
      function showError(container, message) {
        container.innerHTML = `
                <div class="col-span-full text-center py-12">
                    <div class="inline-block p-4 bg-red-100 rounded-full mb-3">
                        <i class="fas fa-exclamation-triangle text-3xl text-red-600"></i>
                    </div>
                    <p class="text-slate-500">${message}</p>
                    <button class="mt-3 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
                        Try Again
                    </button>
                </div>
            `;

        container.querySelector("button").addEventListener("click", loadItems);
      }

      // Render items
      function renderItems(items) {
        if (items.length === 0) {
          itemsContainer.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <div class="inline-block p-4 bg-indigo-100 rounded-full mb-3">
                            <i class="fas fa-box-open text-3xl text-indigo-600"></i>
                        </div>
                        <p class="text-slate-500">No items found</p>
                        ${
                          currentSearchTerm
                            ? `<p class="text-sm mt-2">Try a different search term</p>`
                            : ""
                        }
                    </div>
                `;
          return;
        }

        itemsContainer.innerHTML = items
          .slice(0, 6)
          .map(
            (item) => `
                <div class="card-hover bg-white rounded-xl shadow-sm overflow-hidden cursor-pointer border border-slate-100" data-id="${
                  item._id
                }">
                    <div class="relative h-48 overflow-hidden">
                        ${
                          item.image
                            ? `<img src="${item.image}" alt="${item.title}" class="w-full h-full object-cover transition-transform duration-500 hover:scale-105">`
                            : `<div class="w-full h-full flex items-center justify-center bg-slate-100 text-slate-400">
                                <i class="fas fa-image fa-3x"></i>
                            </div>`
                        }
                        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-4">
                            <span class="inline-block px-3 py-1 rounded-full text-xs font-semibold 
                                ${
                                  item.type === "lost"
                                    ? "bg-red-100 text-red-800"
                                    : "bg-green-100 text-green-800"
                                }">
                                ${item.type === "lost" ? "Lost" : "Found"}
                            </span>
                            ${
                              item.status === "claimed"
                                ? `
                                <span class="inline-block px-3 py-1 rounded-full text-xs font-semibold bg-purple-100 text-purple-800 ml-2">
                                    Reunited
                                </span>
                            `
                                : ""
                            }
                        </div>
                    </div>
                    <div class="p-5">
                        <h3 class="font-bold text-lg mb-1 truncate">${
                          item.title
                        }</h3>
                        <p class="text-slate-600 text-sm mb-3 line-clamp-2">${
                          item.description
                        }</p>
                        <div class="flex items-center justify-between text-sm text-slate-500">
                            <span class="flex items-center">
                                <i class="fas fa-map-marker-alt mr-1.5 text-indigo-500"></i> 
                                ${item.location}
                            </span>
                            <span class="text-slate-400">
                                ${new Date(item.createdAt).toLocaleDateString()}
                            </span>
                        </div>
                    </div>
                </div>
            `
          )
          .join("");

        document.querySelectorAll(".card-hover").forEach((card) => {
          card.addEventListener("click", () => {
            const itemId = card.getAttribute("data-id");
            window.location.href = `item.html?id=${itemId}`;
          });
        });
      }

      // Load suggestions
      async function loadSuggestions() {
        try {
          showLoading(suggestionsContainer, "Loading suggestions...");

          const response = await fetch("/api/suggestions", {
            headers: {
              Authorization: `Bearer ${localStorage.getItem("token")}`,
            },
          });

          if (!response.ok) {
            throw new Error("Failed to fetch suggestions");
          }

          const data = await response.json();
          renderSuggestions(data.suggestions);
        } catch (error) {
          console.error("Error loading suggestions:", error);
          showError(
            suggestionsContainer,
            "Failed to load suggestions. Please try again later."
          );
        }
      }

      // Render suggestions
      function renderSuggestions(suggestions) {
        if (suggestions.length === 0) {
          suggestionsContainer.innerHTML = `
                    <div class="text-center py-12">
                        <div class="inline-block p-4 bg-indigo-100 rounded-full mb-3">
                            <i class="fas fa-comment-slash text-3xl text-indigo-600"></i>
                        </div>
                        <p class="text-slate-500">No suggestions yet. Be the first to share!</p>
                    </div>
                `;
          return;
        }

        suggestionsContainer.innerHTML = suggestions
          .map(
            (suggestion) => `
                <div class="bg-white rounded-xl shadow-sm p-5 border border-slate-100 transition hover:border-indigo-200" data-id="${
                  suggestion._id
                }">
                    <div class="flex items-start space-x-4">
                        ${
                          suggestion.postedBy.profileImage
                            ? `<img src="${suggestion.postedBy.profileImage}" alt="${suggestion.postedBy.firstName}" class="w-10 h-10 rounded-full object-cover border-2 border-indigo-100 shadow-sm mt-1">`
                            : `<div class="w-10 h-10 rounded-full bg-slate-200 flex items-center justify-center mt-1 border-2 border-indigo-100">
                                <i class="fas fa-user text-slate-400"></i>
                              </div>`
                        }
                        <div class="flex-1">
                            <div class="flex items-center justify-between">
                                <h4 class="font-medium text-slate-800">${
                                  suggestion.postedBy.firstName
                                } ${suggestion.postedBy.lastName}</h4>
                                <span class="text-xs text-slate-400">
                                    ${formatTimeAgo(
                                      new Date(suggestion.createdAt)
                                    )}
                                </span>
                            </div>
                            <p class="text-slate-700 mt-2 mb-3">${
                              suggestion.content
                            }</p>
                            ${
                              suggestion.postedBy._id === currentUser._id
                                ? `
                            <div class="flex justify-end space-x-3">
                                <button class="edit-suggestion-btn text-indigo-600 text-sm font-medium hover:text-indigo-800 transition flex items-center">
                                    <i class="fas fa-edit mr-1.5"></i> Edit
                                </button>
                                <button class="delete-suggestion-btn text-red-600 text-sm font-medium hover:text-red-800 transition flex items-center">
                                    <i class="fas fa-trash mr-1.5"></i> Delete
                                </button>
                            </div>
                            `
                                : ""
                            }
                        </div>
                    </div>
                </div>
            `
          )
          .join("");

        document.querySelectorAll(".edit-suggestion-btn").forEach((btn) => {
          btn.addEventListener("click", (e) => {
            e.stopPropagation();
            const suggestionCard = btn.closest("[data-id]");
            const suggestionId = suggestionCard.getAttribute("data-id");
            editSuggestion(suggestionId);
          });
        });

        document.querySelectorAll(".delete-suggestion-btn").forEach((btn) => {
          btn.addEventListener("click", (e) => {
            e.stopPropagation();
            const suggestionCard = btn.closest("[data-id]");
            const suggestionId = suggestionCard.getAttribute("data-id");
            deleteSuggestion(suggestionId);
          });
        });
      }

      // Format time ago
      function formatTimeAgo(date) {
        const seconds = Math.floor((new Date() - date) / 1000);

        let interval = Math.floor(seconds / 31536000);
        if (interval >= 1) return `${interval}y ago`;

        interval = Math.floor(seconds / 2592000);
        if (interval >= 1) return `${interval}mo ago`;

        interval = Math.floor(seconds / 86400);
        if (interval >= 1) return `${interval}d ago`;

        interval = Math.floor(seconds / 3600);
        if (interval >= 1) return `${interval}h ago`;

        interval = Math.floor(seconds / 60);
        if (interval >= 1) return `${interval}m ago`;

        return "Just now";
      }

      // Post new suggestion
      async function postSuggestion() {
        const content = suggestionInput.value.trim();
        if (!content) {
          showToast("Please enter your suggestion", "error");
          return;
        }

        try {
          postSuggestionBtn.disabled = true;
          postSuggestionBtn.innerHTML =
            '<i class="fas fa-spinner fa-spin mr-2"></i> Posting...';

          const response = await fetch("/api/suggestions", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${localStorage.getItem("token")}`,
            },
            body: JSON.stringify({ content }),
          });

          if (!response.ok) {
            throw new Error("Failed to post suggestion");
          }

          const data = await response.json();
          suggestionInput.value = "";
          showToast("Suggestion posted successfully!", "success");
          await loadSuggestions();
        } catch (error) {
          console.error("Error posting suggestion:", error);
          showToast("Failed to post suggestion. Please try again.", "error");
        } finally {
          postSuggestionBtn.disabled = false;
          postSuggestionBtn.textContent = "Post Suggestion";
        }
      }

      // Show toast notification
      function showToast(message, type) {
        const toast = document.createElement("div");
        toast.className = `fixed bottom-5 right-5 px-6 py-3 rounded-lg shadow-lg text-white font-medium ${
          type === "success" ? "bg-green-500" : "bg-red-500"
        } animate-fade-in-up`;
        toast.textContent = message;

        document.body.appendChild(toast);

        setTimeout(() => {
          toast.classList.remove("animate-fade-in-up");
          toast.classList.add("animate-fade-out-down");
          setTimeout(() => {
            toast.remove();
          }, 300);
        }, 3000);
      }

      // Edit suggestion
      async function editSuggestion(suggestionId) {
        const suggestionCard = document.querySelector(
          `[data-id="${suggestionId}"]`
        );
        const contentElement = suggestionCard.querySelector("p.text-slate-700");
        const originalContent = contentElement.textContent;

        contentElement.innerHTML = `
                <textarea class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent mb-3">${originalContent}</textarea>
                <div class="flex justify-end space-x-3">
                    <button class="save-edit-btn px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition">
                        Save
                    </button>
                    <button class="cancel-edit-btn px-4 py-2 bg-slate-200 text-slate-700 rounded-lg font-medium hover:bg-slate-300 transition">
                        Cancel
                    </button>
                </div>
            `;

        const textarea = contentElement.querySelector("textarea");
        textarea.focus();
        textarea.selectionStart = textarea.selectionEnd = textarea.value.length;

        const saveBtn = contentElement.querySelector(".save-edit-btn");
        const cancelBtn = contentElement.querySelector(".cancel-edit-btn");

        saveBtn.addEventListener("click", async () => {
          const newContent = textarea.value.trim();
          if (!newContent) {
            showToast("Suggestion cannot be empty", "error");
            return;
          }

          try {
            saveBtn.disabled = true;
            saveBtn.innerHTML =
              '<i class="fas fa-spinner fa-spin mr-2"></i> Saving...';

            const response = await fetch(`/api/suggestions/${suggestionId}`, {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${localStorage.getItem("token")}`,
              },
              body: JSON.stringify({ content: newContent }),
            });

            if (!response.ok) {
              throw new Error("Failed to update suggestion");
            }

            showToast("Suggestion updated successfully!", "success");
            await loadSuggestions();
          } catch (error) {
            console.error("Error updating suggestion:", error);
            showToast(
              "Failed to update suggestion. Please try again.",
              "error"
            );
          } finally {
            saveBtn.disabled = false;
            saveBtn.textContent = "Save";
          }
        });

        cancelBtn.addEventListener("click", () => {
          contentElement.textContent = originalContent;
        });
      }

      // Delete suggestion
      async function deleteSuggestion(suggestionId) {
        if (!confirm("Are you sure you want to delete this suggestion?")) {
          return;
        }

        try {
          const response = await fetch(`/api/suggestions/${suggestionId}`, {
            method: "DELETE",
            headers: {
              Authorization: `Bearer ${localStorage.getItem("token")}`,
            },
          });

          if (!response.ok) {
            throw new Error("Failed to delete suggestion");
          }

          showToast("Suggestion deleted successfully!", "success");
          await loadSuggestions();
        } catch (error) {
          console.error("Error deleting suggestion:", error);
          showToast("Failed to delete suggestion. Please try again.", "error");
        }
      }

      // Logout function
      async function logout() {
        try {
          localStorage.removeItem("token");
          localStorage.removeItem("user");
          window.location.href = "login.html";
        } catch (error) {
          console.error("Logout error:", error);
          localStorage.removeItem("token");
          localStorage.removeItem("user");
          window.location.href = "login.html";
        }
      }

      // Setup event listeners
      function setupEventListeners() {
        // Search functionality
        searchBtn.addEventListener("click", () => {
          currentSearchTerm = searchInput.value.trim();
          loadItems();
        });

        searchInput.addEventListener("keypress", (e) => {
          if (e.key === "Enter") {
            currentSearchTerm = searchInput.value.trim();
            loadItems();
          }
        });

        // Filter buttons
        filterAll.addEventListener("click", () => {
          currentFilter = "all";
          updateFilterButtons();
          loadItems();
        });

        filterLost.addEventListener("click", () => {
          currentFilter = "lost";
          updateFilterButtons();
          loadItems();
        });

        filterFound.addEventListener("click", () => {
          currentFilter = "found";
          updateFilterButtons();
          loadItems();
        });

        // Post suggestion
        postSuggestionBtn.addEventListener("click", postSuggestion);

        // Post item button
        postItemBtn.addEventListener("click", () => {
          window.location.href = "post-item.html";
        });

        // View all items button
        viewAllItemsBtn.addEventListener("click", () => {
          currentFilter = "all";
          currentSearchTerm = "";
          searchInput.value = "";
          updateFilterButtons();
          loadItems();
        });

        // Logout button
        logoutBtn.addEventListener("click", logout);
      }

      // Setup navbar scroll behavior
      function setupNavbarScroll() {
        let lastScrollTop = 0;
        window.addEventListener(
          "scroll",
          () => {
            let currentScrollTop =
              window.pageYOffset || document.documentElement.scrollTop;
            if (currentScrollTop > lastScrollTop) {
              // Scrolling down
              navbar.classList.add("nav-hidden");
            } else {
              // Scrolling up
              navbar.classList.remove("nav-hidden");
            }
            lastScrollTop = currentScrollTop <= 0 ? 0 : currentScrollTop;
          },
          { passive: false }
        );
      }

      // Update filter buttons active state
      function updateFilterButtons() {
        filterAll.classList.remove("active", "bg-indigo-600", "text-white");
        filterLost.classList.remove("active", "bg-red-600", "text-white");
        filterFound.classList.remove("active", "bg-green-600", "text-white");

        filterAll.classList.add("bg-indigo-100", "text-indigo-600");
        filterLost.classList.add("bg-red-100", "text-red-600");
        filterFound.classList.add("bg-green-100", "text-green-600");

        if (currentFilter === "all") {
          filterAll.classList.add("active", "bg-indigo-600", "text-white");
          filterAll.classList.remove("bg-indigo-100");
        } else if (currentFilter === "lost") {
          filterLost.classList.add("active", "bg-red-600", "text-white");
          filterLost.classList.remove("bg-red-100");
        } else if (currentFilter === "found") {
          filterFound.classList.add("active", "bg-green-600", "text-white");
          filterFound.classList.remove("bg-green-100");
        }
      }
    </script>
  </body>
</html>
